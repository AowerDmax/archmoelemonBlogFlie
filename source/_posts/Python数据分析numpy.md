---
title: Python数据分析numpy
date: 2019-07-15 14:08:59
tags:
- 数据分析
- Python
- numpy
---

# Python数据分析之numpy

Numpy是Python的一种开源的数值计算扩展。这种工具可用来储存和处理大型矩阵比Python自身的嵌套列表（nested list structure）结构要高效的多。numpy
提供了许多高级的数值编程工具。Numpy的一个重要特性是它的数组计算，是做数据分析必不可少的一个包

导入python库使用关键字import， 后面可以自定义库的简称， 但是一般都将Numpy命名为np， pandas命名为pd

使用前一定要先导入Numpy包， 导入的方式有以下几种

import numpy

> 导入numpy包， 在使用numpy里面的函数时， 必须是numpy.  的形式

import numpy as np

> 导入numpy包， 并将其重命名为np， 在使用numpy里的函数时， 必须是 np. 的形式

from numpy import *

> 不用加任何前缀， 速度较慢， 且容易发生冲突， 不建议使用 


```python
import numpy as np
```

### 1.Numpy的数组对象及其索引
#### 数组上的数学操作

假如我们想将列表中的每个元素增加1，但列表不支持这样的操作：


```python
a = [1, 2, 3, 4, 5]
[x+1 for x in a]
```




    [2, 3, 4, 5, 6]




```python
b = [2, 3, 4, 5, 6]
a+b
```




    [1, 2, 3, 4, 5, 2, 3, 4, 5, 6]



zip是一个打包命令可以让a, b 列表组成一个一个的数对


```python
[x+y for (x, y) in zip(a, b)]
```




    [3, 5, 7, 9, 11]



与另一个数组相加，得到对应元素相加的结果：

#### 这样的操作比较麻烦，而且在数据量特别大的时候会非常耗时间
#### 如果我们使用numpy， 就会变得特别简单

##### 初始化一个numpy数组


```python
a = np.array([1, 2, 3, 4])
a
```




    array([1, 2, 3, 4])




```python
a+1
```




    array([2, 3, 4, 5])




```python
a * 2
```




    array([2, 4, 6, 8])



#### 产生数组

从列表产生数组


```python
list1 = [1, 2, 3, 4]
my_list = np.array(list1)
my_list
```




    array([1, 2, 3, 4])



从列表传入数组


```python
my_list =   np.array([0, 1, 2, 3])
my_list
```




    array([0, 1, 2, 3])



生成全0数组


```python
np.zeros(5)
```




    array([0., 0., 0., 0., 0.])



生成全1数组

默认生成的数组为浮点型， 若要进行类型的转换可以使用dtype


```python
np.ones(5,dtype = 'int')
```




    array([1, 1, 1, 1, 1])



可以使用fill方法将数组设为指定值


```python
a = np.zeros(6, dtype = 'int')
a.fill(5)
a
```




    array([5, 5, 5, 5, 5, 5])



与列表不同， 数组中要求所有元素的type是一样的， 如果传入参数的类型与数组类型不一样， 需按照已有的类型进行转换


```python
a = a.astype('float')
a
```




    array([5., 5., 5., 5., 5., 5.])



还可以使用一些特定的方法生成特殊数组

生成整数序列


```python
# 生成整数序列， 左闭右开， 不包含右边
a = np.arange(1, 10)
a
```




    array([1, 2, 3, 4, 5, 6, 7, 8, 9])




```python
# 第三个参数指定相邻元素的差值
a = np.arange(1, 10, 2)
a
```




    array([1, 3, 5, 7, 9])



生成等差数列


```python
# linsapce 生成等差数列， 包含1到10， 平均等分为19份
a = np.linspace(1, 10, 19)
a
```




    array([ 1. ,  1.5,  2. ,  2.5,  3. ,  3.5,  4. ,  4.5,  5. ,  5.5,  6. ,
            6.5,  7. ,  7.5,  8. ,  8.5,  9. ,  9.5, 10. ])



生成随机数


```python
# 生成的随机数分布在0~1之间， 左闭右开
# 生成10个随机数
np.random.rand(10)
```




    array([0.47858337, 0.27552828, 0.23564354, 0.32176268, 0.0649055 ,
           0.06550039, 0.10144269, 0.09723159, 0.39374272, 0.2053621 ])



服从标准正态分布的随机数


```python
np.random.randn(10)
```




    array([-1.71106368,  0.01290357,  0.11539743,  0.0945762 ,  0.27211728,
           -1.72631161, -0.07228001,  1.78744359, -0.04889052,  0.47681058])




```python
np.random.randint(1, 10, 10)
```




    array([4, 7, 2, 1, 7, 7, 3, 9, 7, 7])



### 数组属性

查看类型


```python
a
```




    array([ 1. ,  1.5,  2. ,  2.5,  3. ,  3.5,  4. ,  4.5,  5. ,  5.5,  6. ,
            6.5,  7. ,  7.5,  8. ,  8.5,  9. ,  9.5, 10. ])




```python
type(a)
```




    numpy.ndarray



查看数组中的数据类型


```python
a.dtype
```




    dtype('float64')



查看形状， 会返回一个元组， 每一个元素代表这一堆的元素数目


```python
a.shape
```




    (19,)



或者使用：


```python
np.shape(a)
```




    (19,)




```python
np.size(a)
```




    19



查看数组里面元素的数目


```python
a.size 
```




    19



查看数组的维度


```python
a.ndim
```




    1



## 索引和切片

和列表相似， 数组也支持索引和切片操作

索引第一个元素


```python
a = np.array([1, 2, 3])
a[0]
```




    1



修改第一个元素的值


```python
a[0] = 10
a
```




    array([10,  2,  3])



切片， 支持负索引：


```python
# 注意左闭右开
a[::-1]
```




    array([ 3,  2, 10])



假设我们记录一部电影的累计票房


```python
ob  = np.array([1000, 2100, 3300, 4600, 6000])
ob
```




    array([1000, 2100, 3300, 4600, 6000])



可以这样计算每天的票房


```python
front_ob = ob[:-1]
front_ob
```




    array([1000, 2100, 3300, 4600])




```python
back_ob = ob[1:]
back_ob
```




    array([2100, 3300, 4600, 6000])




```python
end_ob = back_ob - front_ob
end_ob
```




    array([1100, 1200, 1300, 1400])



###  多维数组及其属性

array还可以用来生成多为数组


```python
a = np.array([[0, 1, 2, 3], [10, 11, 12, 13]])
a
```




    array([[ 0,  1,  2,  3],
           [10, 11, 12, 13]])



事实上我们传入的是一个以列表为元素的列表， 最终得到一个二维数组

查看形状


```python
np.shape(a)
```




    (2, 4)



查看总的元素个数


```python
a.size
```




    8



查看维数


```python
a.ndim
```




    2



### 各维数组索引

对于二维数组， 可以传入两个数字来索引


```python
a
```




    array([[ 0,  1,  2,  3],
           [10, 11, 12, 13]])



可以通过两个中括号的形式或者一个中括号里面有逗号的形式来进行索引


```python
a[1][2]
a[1, 3]
```




    13



可以使用单个索引来索引一整行的内容

也可以使用索引来给一整行进行赋值


```python
a[0]
```




    array([0, 1, 2, 3])



可以使用索引来索引一整列的内容


```python
a[:, 1]
```




    array([0, 1, 2, 3])



#### 多维数组的切片

多维数组， 也支持切片操作


```python
a = np.array([[1, 2, 3, 4, 5, 6, 7, 8], [11, 12, 13, 14, 15, 16, 17, 18],  [21, 22, 23, 24, 25, 26, 27, 28], [31, 32, 33, 34, 35, 36, 37, 38], [41, 42, 43, 44, 45, 46, 47, 48], [51, 52, 53, 54, 55, 56, 57, 58]])
a
```




    array([[ 1,  2,  3,  4,  5,  6,  7,  8],
           [11, 12, 13, 14, 15, 16, 17, 18],
           [21, 22, 23, 24, 25, 26, 27, 28],
           [31, 32, 33, 34, 35, 36, 37, 38],
           [41, 42, 43, 44, 45, 46, 47, 48],
           [51, 52, 53, 54, 55, 56, 57, 58]])



想得到第一行的第四和第五两个元素


```python
a[0, 4:6]
```




    array([5, 6])



想得到最后两行的最后两列


```python
a[-2:,-2:]
```




    array([[47, 48],
           [57, 58]])



得到第三列


```python
a[:, 2]
```




    array([ 3, 13, 23, 33, 43, 53])



每一维都支持切片的规则，包括负索引， 省略

[lower:upper:step]

取出3， 5行的奇数列


```python
a[3::2, ::2]
```




    array([[31, 33, 35, 37],
           [51, 53, 55, 57]])



#### 切片是引用

  切片在内存中使用的是引用机制

列表list和数组使用的机制是不一样的

list使用copy

数组使用引用


```python
a = np.array([1, 2, 3, 4, 5])
b = a[1:3]
print(b)
b[0] = 10
print(a)
```

    [2 3]
    [ 1 10  3  4  5]



```python
a = [1, 2, 3, 4, 5]
b = a[2:3]
print(b)
b[0] = 10
print(b)
print(a)
```

    [3]
    [10]
    [1, 2, 3, 4, 5]


引用机制意味着， Python并没有为b分配新的空间来储存它的值， 而是让b指向了a所分配的内存空间， 因此， 改变b 会改变a 的值

这样做的好处在于， 对于很大的数组， 不用大量复制多余的值， 节省了空间

缺点在于， 可能出现改变一个值改变另一个值的情况

一个解决方案是使用copy()方法产生一个复制， 这个复制会申请新的内存


```python
a = np.array([1, 2, 3, 4, 5])
b = a[2:4].copy()
print(b)
b[0] = 10
print(a)
```

    [3 4]
    [1 2 3 4 5]


### 花式索引

切片只能支持连续或者等间隔的切片操作， 要想实现任意位置的操作， 需要使用花式索引 

fancy slicing

#### 一维花式索引

与range函数类似， 我们可以使用arange函数来产生等差数组


```python
a = np.arange(0, 100, 10)
a
```




    array([ 0, 10, 20, 30, 40, 50, 60, 70, 80, 90])



花式索引需要指定索引位置


```python
index = [1, 2, -3]
b = a[index]
print(b)
```

    [10 20 70]


还可以使用布尔数组来花式索引


```python
mask = np.array([0, 1, 0, 1, 0, 1, 0, 1, 0, 1], dtype = bool)
mask
```




    array([False,  True, False,  True, False,  True, False,  True, False,
            True])



mask必须是布尔数组， 长度必须和数组的长度相同 


```python
b = a[mask]
print(b)
```

    [10 30 50 70 90]


#### 二维花式索引

对于二维花式索引， 我们需要给定行和列的值



```python
a = np.array([[1, 2, 3, 4, 5, 6, 7, 8], [11, 12, 13, 14, 15, 16, 17, 18],  [21, 22, 23, 24, 25, 26, 27, 28], [31, 32, 33, 34, 35, 36, 37, 38], [41, 42, 43, 44, 45, 46, 47, 48], [51, 52, 53, 54, 55, 56, 57, 58]])
a
```




    array([[ 1,  2,  3,  4,  5,  6,  7,  8],
           [11, 12, 13, 14, 15, 16, 17, 18],
           [21, 22, 23, 24, 25, 26, 27, 28],
           [31, 32, 33, 34, 35, 36, 37, 38],
           [41, 42, 43, 44, 45, 46, 47, 48],
           [51, 52, 53, 54, 55, 56, 57, 58]])



返回的是一条次对角线上的五个值

元组， zip, (), ()


```python
a[(0, 1, 2, 3, 4, 5), (1, 2, 3, 4, 5, 6)]
```




    array([ 2, 13, 24, 35, 46, 57])



返回的是最后三行的第1， 3， 5列


```python
 a[-3:, 1:6:2]
```




    array([[32, 34, 36],
           [42, 44, 46],
           [52, 54, 56]])



也可以使用mask进行索引


```python
mask = np.array([1, 0, 1, 0, 1, 0], dtype = bool)
mask
```




    array([ True, False,  True, False,  True, False])




```python
a[mask, 2]
```




    array([ 3, 23, 43])



与切片不同， 花式索引返回的是原对象的一个复制而不是引用

### "不完全"索引

只给定行索引的时候， 返回整行


```python
y = a[:3]
y
```




    array([[ 1,  2,  3,  4,  5,  6,  7,  8],
           [11, 12, 13, 14, 15, 16, 17, 18],
           [21, 22, 23, 24, 25, 26, 27, 28]])



这时候也可以使用花式索引取出2， 3， 5行

长度必须相同


```python
flag = np.array([0, 1, 1, 0, 1, 0], dtype = bool)
flag
y = a[flag]
y
```




    array([[11, 12, 13, 14, 15, 16, 17, 18],
           [21, 22, 23, 24, 25, 26, 27, 28],
           [41, 42, 43, 44, 45, 46, 47, 48]])



### where语句

where(array)

where函数会返回所有非零函数的索引

#### 一维数组

先看一维的例子


```python
a = np.array([12, 15, 18, 0, 1, 2, 8])
a
```




    array([12, 15, 18,  0,  1,  2,  8])



判断数组中的元素是不是大于10


```python
a>10
```




    array([ True,  True,  True, False, False, False, False])



数组中所有大于10的元素的索引位置


```python
np.where(a>10)
```




    (array([0, 1, 2], dtype=int32),)



注意到where的返回值是一个元组， 返回的是索引位置， 索引[1, 1, 2]大于10的数

也可以直接用数组操作


```python
a[a>10]
```




    array([12, 15, 18])




```python
a[np.where(a>10)]
```




    array([12, 15, 18])



### 数组类型

#### 类型转换


```python
a = np.array([1.5, -3], dtype = float)
a
```




    array([ 1.5, -3. ])



#### asarray函数

类型转换， 第一个是需要转换的数组， 第二是需要转换的类型， dtype = float


```python
a = np.array([1, 2, 3])
np.asarray(a, dtype = float)
```




    array([1., 2., 3.])



#### astype 方法

astype 方法返回一个新数组,返回一个新的数组， copy


```python
a = np.array([1, 2, 3])
a.astype(float)
```




    array([1., 2., 3.])



### 数组操作

##### 我们以豆瓣十部高分电影为例


```python
# 电影名称
mv_name = ['肖申克的救赎'
, '控方证人'
,'美丽人生' 
,'阿甘正传'
,'霸王别姬'
,'泰坦尼克号 '
,'辛德勒的名单'
,'新世纪福音战士剧场版：Air/真心为你 新世紀エヴァンゲリオン劇場版 Ai'
,'银魂完结篇：直到永远的万事屋 劇場版 銀魂 完結篇 万事屋よ'
]
```


```python
# 评分人数
mv_num = np.array([692795
,42995
,327855
,580897
,478523
,157074
,306904
,24355
,21513
])
```


```python
# 评分
mv_score = np.array([9.6
,9.5
,9.5
,9.4
,9.4
,9.4
,9.4
,9.4
,9.4
])
```


```python
# 电影时长
mv_length = np.array([142
,116
,116
,142
,171
,194
,195
,87
,110
])
```

#### 数组排序

#### sort函数

从小到大排序


```python
np.sort(mv_num)
```




    array([ 21513,  24355,  42995, 157074, 306904, 327855, 478523, 580897,
           692795])




```python
mv_num
```




    array([692795,  42995, 327855, 580897, 478523, 157074, 306904,  24355,
            21513])



#### argsort函数

argsort 返回从小到大的排序在数组中的索引位置


```python
 np.argsort(mv_num)
```




    array([8, 7, 1, 5, 6, 2, 4, 3, 0], dtype=int32)



### 求和


```python
np.sum(mv_num)
```




    2632911




```python
mv_num.sum()
```




    2632911



##### 求最大值


```python
np.max(mv_num)
```




    692795




```python
mv_num.max()
```




    692795



##### 求最小值


```python
mv_num.min()
```




    21513



##### 均值


```python
mv_num.mean()
```




    292545.6666666667




```python
np.mean(mv_num)
```




    292545.6666666667



#### 标准差


```python
np.std(mv_num)
```




    236971.52837184657




```python
mv_num.mean()
```




    292545.6666666667



#### 相关系数矩阵


```python
np.cov(mv_score, mv_length)
```




    array([[ 5.27777778e-03, -6.22222222e-01],
           [-6.22222222e-01,  1.46902778e+03]])



### 多维数组的操作

#### 数组形状


```python
a = np.arange(0, 6)
a
```




    array([0, 1, 2, 3, 4, 5])




```python
a.shape = 2, 3
a
```




    array([[0, 1, 2],
           [3, 4, 5]])



与之对应的方法是reshape， 但它不会修改原来数组的值， 而是返回一个新的数组


```python
a = np.arange(6)
b = a.reshape(2, 3)
b
print(a)
```

    [0 1 2 3 4 5]


#### 转置


```python
b.T
```




    array([[0, 3],
           [1, 4],
           [2, 5]])




```python
b.transpose()
```




    array([[0, 3],
           [1, 4],
           [2, 5]])



#### 数组连接

有时我们需要将不同的数组按照一定的顺序连接起来

concatenate((a0, a1, ...., aN), axis = 0)

axis方向

0默认， 默认按照纵向来进行拼接

1可更改， 按照横向进行拼接

注意： 这些数组要用（）， 包含到一个元组中去

除了给定的轴外， 这些数组其他轴的长度必须是一样的


```python
a = np.arange(6)
b = np.arange(6)
a.shape = 2, 3
b.shape = 2, 3
print(a.shape)
print(b.shape)
```

    (2, 3)
    (2, 3)


默认沿着第一维进行连接


```python
z = np.concatenate((a, b))
z
```




    array([[0, 1, 2],
           [3, 4, 5],
           [0, 1, 2],
           [3, 4, 5]])



沿着第二维进行连接


```python
z = np.concatenate((a, b), axis = 1)
z
```




    array([[0, 1, 2, 0, 1, 2],
           [3, 4, 5, 3, 4, 5]])



注意到这里x和y的形状是一样的， 还可以将他们连接成三维的数组， 但是`concatenate`不能提供这样的功能， 不过可以这样：

* vstack
* hstack
* dstack


```python
np.vstack((a, b))
```




    array([[0, 1, 2],
           [3, 4, 5],
           [0, 1, 2],
           [3, 4, 5]])




```python
np.hstack((a, b))
```




    array([[0, 1, 2, 0, 1, 2],
           [3, 4, 5, 3, 4, 5]])




```python
z = np.dstack((a, b))
z
```




    array([[[0, 0],
            [1, 1],
            [2, 2]],
    
           [[3, 3],
            [4, 4],
            [5, 5]]])




```python
z[0]
```




    array([[0, 0],
           [1, 1],
           [2, 2]])




```python
z[0,0]
```




    array([0, 0])




```python
z[0, 0, 0]
```




    0



#### 求绝对值


```python
a = np.array([-1, 2, 3, -2])
```


```python
np.abs(a)
```




    array([1, 2, 3, 2])



#### 求指数


```python
np.exp(a)
```




    array([ 0.36787944,  7.3890561 , 20.08553692,  0.13533528])



#### 求中值


```python
np.median(a)
```




    0.5



#### 求累计和


```python
np.cumsum(a)
```




```python
array([-1,  1,  4,  2], dtype=int32)
```